<?php
/** @var $data \WidRestApiDocumentator\DataInterface */
$data = $this->data;
$config = $data->getConfig();
$resourceSet = $data->getResourceSet();
/** @var $resource \WidRestApiDocumentator\ResourceInterface */
/** @var $param \WidRestApiDocumentator\ParamInterface */
$esc = $this->plugin('EscapeHtml');
?>
<h1><?= $config->getName() ?> <span class="label label-info"><?= $config->getVersion()?></span></h1>

<?php if ($this->showBackLink): ?>
<p><a href="<?= $this->url('rest-api-docs')?>"><i class="icon-chevron-left"></i> Go back to list</a></p>
<?php endif; ?>

<?php foreach($resourceSet as $resource): ?>
<div class="entrypoint">
    <span class="api-method api-method-<?= strtolower($esc($resource->getMethod()))?>"><?= $esc($resource->getMethod())?></span>
    <span class="api-url">
        <span data-href="<?= $config->getBaseUrl() . $resource->getUrl() ?>" class="test-request"><i class="icon-play"></i></span>
        <a href="<?= $config->getBaseUrl() . $resource->getUrl() ?>" target="_blank"><i class="icon-share-alt"></i></a>
        <?php
            // TODO: This, should be move to helper.
            $urlParams = $resource->getUrlParams();
            if (count($urlParams)) {
                $urlParams->rewind();
                echo preg_replace_callback('/(?<value><[^>]+>)/', function($matches) use($urlParams){
                    $param = $urlParams->current();
                    $urlParams->next();
                    return sprintf('<input name="%s" placeholder="%s" class="param-placeholder"/>', $param->getName(), $matches['value']);
                }, $resource->getUrl());
            } else {
                echo $esc($resource->getUrl());
            }
        ?>
    </span>
    <p class="api-description muted"><?= $esc($resource->getDescription()); ?></p>
    <div class="toggable">
        <div class="toggable-response">
            <h4>Response body</h4>
            <textarea class="response"></textarea>
        </div>

        <?= $this->partial('wid-rest-api-documentator/partials/params', array('params' => $resource->getUrlParams(), 'header' => 'Url params')); ?>
        <?= $this->partial('wid-rest-api-documentator/partials/params', array('params' => $resource->getQueryParams(), 'header' => 'Query params')); ?>
    </div>
</div>
<?php endforeach; ?>